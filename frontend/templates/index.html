<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loja de Cupcakes</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <header>
        <header>
            <div class="header-content">
                <a href="{{ url_for('home') }}" class="logo">
                    <h1>ğŸ° CupcakeStore</h1>
                </a>
                <div class="carrinho-info">
                    {% if session.get('user_id') %}
                    <!-- ğŸ‘‡ USUÃRIO LOGADO - MENU DROPDOWN MELHORADO -->
                    <div class="user-info">
                        <div class="user-menu">
                            <div class="user-trigger">
                                <span class="user-avatar">ğŸ‘¤</span>
                                <span class="user-name">{{ session['username'] }}</span>
                                <span class="dropdown-arrow">â–¼</span>
                            </div>
                            <div class="dropdown-content">
                                <a href="{{ url_for('meus_pedidos') }}" class="dropdown-item">
                                    <span class="item-icon">ğŸ“¦</span>
                                    Meus Pedidos
                                </a>

                                <!-- ğŸ‘‡ NOVO ITEM - SÃ“ APARECE PARA ADMINS -->
                                {% if is_admin() %}
                                <a href="{{ url_for('admin_dashboard') }}" class="dropdown-item">
                                    <span class="item-icon">ğŸ‘‘</span>
                                    Menu Admin
                                </a>
                                {% endif %}

                                <a href="{{ url_for('logout') }}" class="dropdown-item">
                                    <span class="item-icon">ğŸšª</span>
                                    Sair
                                </a>
                            </div>
                        </div>
                        <button onclick="verCarrinho()">ğŸ›’ Carrinho (<span id="contador-carrinho">0</span>)</button>
                    </div>
                    {% else %}
                    <!-- ğŸ‘‡ USUÃRIO NÃƒO LOGADO -->
                    <div class="auth-buttons">
                        <a href="{{ url_for('login') }}" class="btn-login">ğŸ”‘ Login</a>
                        <a href="{{ url_for('register') }}" class="btn-register">ğŸ“ Cadastrar</a>
                        <button onclick="verCarrinho()">ğŸ›’ Carrinho (<span id="contador-carrinho">0</span>)</button>
                    </div>
                    {% endif %}
                </div>
            </div>
            <p>A melhor loja de cupcakes da internet!</p>

            <!-- Barra de pesquisa -->
            <div class="search-bar">
                <input type="text" placeholder="ğŸ” Pesquisar cupcakes..." id="searchInput" value="{{ termo_pesquisa }}">
                <button onclick="filtrarCupcakes()">Buscar</button>
            </div>
        </header>

        <main>
            <div class="produtos">
                <h2>Nossos Cupcakes</h2>

                <!-- VERIFICA SE EXISTEM PRODUTOS -->
                {% if produtos %}
                <div class="grid-produtos">
                    <!-- LOOP PARA CADA PRODUTO -->
                    {% for produto in produtos %}
                    <div class="produto">
                        {% if produto['imagem'] is defined and produto['imagem'] %}
                        <img src="{{ url_for('static', filename=produto['imagem']) }}" alt="{{ produto['nome'] }}"
                            style="max-width: 100%; height: 200px; object-fit: cover; border-radius: 8px; margin-bottom: 15px;">
                        {% else %}
                        <div
                            style="height: 200px; background: #f0f0f0; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 15px;">
                            ğŸ§ Sem imagem
                        </div>
                        {% endif %}
                        <h3>{{ produto['nome'] }}</h3>
                        <p class="descricao">{{ produto['descricao'] }}</p>
                        <p class="preco">R$ {{ "%.2f"|format(produto['preco']) }}</p>
                        <button onclick="comprar({{ produto['id'] }}, '{{ produto['nome'] }}', this)">ğŸ›’
                            Comprar</button>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <!-- ğŸ”½ MENSAGEM MELHORADA PARA NENHUM RESULTADO -->
                {% if termo_pesquisa %}
                <div class="nenhum-resultado"
                    style="text-align: center; padding: 40px; background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <h3 style="color: #ff6b8b;">ğŸ˜¢ Nenhum cupcake encontrado</h3>
                    <p>NÃ£o encontramos resultados para "<strong>{{ termo_pesquisa }}</strong>"</p>
                    <a href="{{ url_for('home') }}" class="btn-comprar" style="margin-top: 15px;">Ver Todos os
                        Cupcakes</a>
                </div>
                {% else %}
                <div style="text-align: center; padding: 40px;">
                    <p>Nenhum produto disponÃ­vel no momento.</p>
                </div>
                {% endif %}
                {% endif %}
            </div>
        </main>

        <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>

</html>