{% extends "Admin/base.html" %}

{% block title %}Pedidos - CupcakeStore{% endblock %}

{% block content %}
<!-- 👇 ESTATÍSTICAS COMPACTAS -->
<div class="estatisticas-compactas">
    <div class="filtro-status-compacto">
        <button class="btn-status-compacto todos {% if status_filter == 'todos' %}ativo{% endif %}" onclick="filtrarPorStatus('todos')">
            <i class="fas fa-boxes"></i> Todos ({{ pedidos|length }})
        </button>
        <button class="btn-status-compacto pendente {% if status_filter == 'pendente' %}ativo{% endif %}" onclick="filtrarPorStatus('pendente')">
            <i class="fas fa-clock"></i> Pendentes ({{ contagem_status | selectattr('status', 'equalto', 'pendente') | map(attribute='count') | first | default(0) }})
        </button>
        <button class="btn-status-compacto processando {% if status_filter == 'processando' %}ativo{% endif %}" onclick="filtrarPorStatus('processando')">
            <i class="fas fa-cogs"></i> Processando ({{ contagem_status | selectattr('status', 'equalto', 'processando') | map(attribute='count') | first | default(0) }})
        </button>
        <button class="btn-status-compacto pronto {% if status_filter == 'pronto' %}ativo{% endif %}" onclick="filtrarPorStatus('pronto')">
            <i class="fas fa-check-circle"></i> Prontos ({{ contagem_status | selectattr('status', 'equalto', 'pronto') | map(attribute='count') | first | default(0) }})
        </button>
        <button class="btn-status-compacto enviado {% if status_filter == 'enviado' %}ativo{% endif %}" onclick="filtrarPorStatus('enviado')">
            <i class="fas fa-shipping-fast"></i> Enviados ({{ contagem_status | selectattr('status', 'equalto', 'enviado') | map(attribute='count') | first | default(0) }})
        </button>
        <button class="btn-status-compacto entregue {% if status_filter == 'entregue' %}ativo{% endif %}" onclick="filtrarPorStatus('entregue')">
            <i class="fas fa-home"></i> Entregues ({{ contagem_status | selectattr('status', 'equalto', 'entregue') | map(attribute='count') | first | default(0) }})
        </button>
        <button class="btn-status-compacto cancelado {% if status_filter == 'cancelado' %}ativo{% endif %}" onclick="filtrarPorStatus('cancelado')">
            <i class="fas fa-times-circle"></i> Cancelados ({{ contagem_status | selectattr('status', 'equalto', 'cancelado') | map(attribute='count') | first | default(0) }})
        </button>
    </div>
    <div class="acoes-avancadas">
        <button class="btn-status-avancado reset-numeracao" onclick="abrirModalResetNumeracao()">
            <i class="fas fa-sync-alt"></i> Resetar Numeração
        </button>
        <button class="btn-status-avancado excluir-todos" onclick="abrirModalExcluirTodos()">
            <i class="fas fa-trash-alt"></i> Excluir Todos
        </button>
    </div>
</div>

<!-- 👇 LISTA DE PEDIDOS -->
<div class="pedidos-grid">
    {% if pedidos %}
    {% for pedido in pedidos %}
    <div class="pedido-card {{ pedido['status'] }}">
        <div class="pedido-header">
            <div class="pedido-info">
                <h3>Pedido #{{ pedido['id'] }}</h3>
                <p><strong>Cliente:</strong> {{ pedido['username'] }}</p>
                <p><strong>Data:</strong> {{ pedido['created_at'] }}</p>
                <p><strong>Total:</strong> R$ {{ "%.2f"|format(pedido['total_amount']) }}</p>
                <p><strong>Pagamento:</strong>
                    {% if pedido['metodo_pagamento'] == 'dinheiro' %}💵 Dinheiro{% endif %}
                    {% if pedido['metodo_pagamento'] == 'cartao' %}💳 Cartão{% endif %}
                    {% if pedido['metodo_pagamento'] == 'pix' %}📱 PIX{% endif %}
                    {% if not pedido['metodo_pagamento'] %}💳 Cartão (padrão){% endif %}
                </p>
                <p><strong>Entrega:</strong>
                    {% if pedido['forma_entrega'] == 'delivery' %}🚚 Delivery{% endif %}
                    {% if pedido['forma_entrega'] == 'retirada' %}🏪 Retirada{% endif %}
                    {% if not pedido['forma_entrega'] %}🚚 Delivery (padrão){% endif %}
                </p>
            </div>
            <span class="pedido-status status-{{ pedido['status'] }}">
                <i class="fas 
                    {% if pedido['status'] == 'pendente' %}fa-clock
                    {% elif pedido['status'] == 'processando' %}fa-cogs
                    {% elif pedido['status'] == 'pronto' %}fa-check-circle
                    {% elif pedido['status'] == 'enviado' %}fa-shipping-fast
                    {% elif pedido['status'] == 'entregue' %}fa-home
                    {% elif pedido['status'] == 'cancelado' %}fa-times-circle
                    {% endif %}">
                </i>
                {{ pedido['status']|title }}
            </span>
        </div>

        <div class="pedido-itens">
            <strong>Itens do Pedido:</strong>
            {% if pedido.order_data %}
            {% set order_data = pedido.order_data %}
            {% if order_data is string %}
            {% set order_data = order_data|parse_json %}
            {% endif %}

            {% if order_data.itens is defined %}
            {% for item in order_data.itens %}
            <div class="item-pedido">
                <span>{{ item.quantidade }}x {{ item.nome }}</span>
                <span>R$ {{ "%.2f"|format(item.preco * item.quantidade) }}</span>
            </div>
            {% endfor %}
            {% else %}
            {% for item in order_data %}
            <div class="item-pedido">
                <span>
                    {% if item.quantidade %}{{ item.quantidade }}x {% endif %}
                    {{ item.nome if item.nome else 'Item' }}
                </span>
                <span>
                    R$
                    {% if item.preco and item.quantidade %}
                    {{ "%.2f"|format(item.preco * item.quantidade) }}
                    {% elif item.preco %}
                    {{ "%.2f"|format(item.preco) }}
                    {% else %}
                    0.00
                    {% endif %}
                </span>
            </div>
            {% endfor %}
            {% endif %}
            {% else %}
            <p>Nenhum item disponível</p>
            {% endif %}
        </div>
        <div class="pedido-acoes-dropdown">
            <button class="dropdown-trigger-pedido" onclick="toggleDropdown(this)">
                <i class="fas fa-cog"></i> Ações
                <i class="fas fa-chevron-down dropdown-arrow"></i>
            </button>
            <div class="dropdown-content-pedido">
                <div class="status-section">
                    <label for="status-{{ pedido['id'] }}"><i class="fas fa-exchange-alt"></i> Alterar Status:</label>
                    <select class="select-status" id="status-{{ pedido['id'] }}" onchange="atualizarIconeStatus({{ pedido['id'] }})">
                        <option value="pendente" {% if pedido['status']=='pendente' %}selected{% endif %}>
                            <i class="fas fa-clock"></i> Pendente
                        </option>
                        <option value="processando" {% if pedido['status']=='processando' %}selected{% endif %}>
                            <i class="fas fa-cogs"></i> Processando
                        </option>
                        <option value="pronto" {% if pedido['status']=='pronto' %}selected{% endif %}>
                            <i class="fas fa-check-circle"></i> Pronto
                        </option>
                        <option value="enviado" {% if pedido['status']=='enviado' %}selected{% endif %}>
                            <i class="fas fa-shipping-fast"></i> Enviado
                        </option>
                        <option value="entregue" {% if pedido['status']=='entregue' %}selected{% endif %}>
                            <i class="fas fa-home"></i> Entregue
                        </option>
                        <option value="cancelado" {% if pedido['status']=='cancelado' %}selected{% endif %}>
                            <i class="fas fa-times-circle"></i> Cancelado
                        </option>
                    </select>
                </div>
                <button class="dropdown-item-pedido" onclick="abrirModalAtualizarStatus({{ pedido['id'] }})">
                    <i class="fas fa-save"></i> Atualizar Status
                </button>
                <button class="dropdown-item-pedido" onclick="abrirModalExclusaoPedido({{ pedido['id'] }}, {{ pedido['total_amount'] }})">
                    <i class="fas fa-trash-alt"></i> Excluir Pedido
                </button>
            </div>
        </div>
    </div>
    {% endfor %}
    {% else %}
    <div class="nenhum-pedido">
        <h2><i class="fas fa-box-open"></i> Nenhum pedido encontrado</h2>
        <p>Não há pedidos com o status selecionado.</p>
        <div class="btn-container">
            <button class="btn-status-compacto todos" onclick="filtrarPorStatus('todos')">
                <i class="fas fa-boxes"></i> Ver Todos os Pedidos
            </button>
        </div>
    </div>
    {% endif %}
</div>

<!-- 👇 MODAL DE CONFIRMAÇÃO PARA ATUALIZAR STATUS -->
<div id="modalAtualizarStatus" class="modal-confirmacao">
    <div class="modal-confirmacao-conteudo">
        <div class="modal-confirmacao-cabecalho">
            <h3>🔄 Confirmar Atualização</h3>
            <span class="modal-confirmacao-fechar" onclick="fecharModalAtualizarStatus()">&times;</span>
        </div>
        <div class="modal-confirmacao-corpo">
            <p>Tem certeza que deseja atualizar o status do pedido <strong id="id-pedido-atualizar">#000</strong>?
            </p>
            <p>Novo status: <strong id="novo-status-atualizar">Pendente</strong></p>
        </div>
        <div class="modal-confirmacao-rodape">
            <button class="btn-modal btn-modal-cancelar" onclick="fecharModalAtualizarStatus()">
                <i class="fas fa-times"></i> Cancelar
            </button>
            <button class="btn-modal btn-modal-confirmar" onclick="confirmarAtualizarStatus()">
                <i class="fas fa-check"></i> Sim, Atualizar
            </button>
        </div>
    </div>
</div>

<!-- 👇 MODAL DE CONFIRMAÇÃO PARA EXCLUSÃO DE PEDIDOS (PADRONIZADO) -->
<div id="modalExclusaoPedido" class="modal-confirmacao">
    <div class="modal-confirmacao-conteudo">
        <div class="modal-confirmacao-cabecalho">
            <h3>📦 Confirmar Exclusão de Pedido</h3>
            <span class="modal-confirmacao-fechar" onclick="fecharModalPedido()">&times;</span>
        </div>
        <div class="modal-confirmacao-corpo">
            <p>Tem certeza que deseja excluir o pedido <strong id="id-pedido-excluir">#000</strong>?</p>
            <p>Valor total: <strong id="valor-pedido-excluir">R$ 0,00</strong></p>
            <p>⚠️ <strong>Esta ação não pode ser desfeita!</strong></p>
        </div>
        <div class="modal-confirmacao-rodape">
            <button class="btn-modal btn-modal-cancelar" onclick="fecharModalPedido()">
                <i class="fas fa-times"></i> Cancelar
            </button>
            <button class="btn-modal btn-modal-confirmar" onclick="confirmarExclusaoPedido()">
                <i class="fas fa-trash"></i> Sim, Excluir
            </button>
        </div>
    </div>
</div>

<!-- 👇 MODAL DE CONFIRMAÇÃO PARA RESET DE NUMERAÇÃO (PADRONIZADO) -->
<div id="modalResetNumeracao" class="modal-confirmacao">
    <div class="modal-confirmacao-conteudo">
        <div class="modal-confirmacao-cabecalho">
            <h3>🔄 Resetar Numeração de Pedidos</h3>
            <span class="modal-confirmacao-fechar" onclick="fecharModalResetNumeracao()">&times;</span>
        </div>
        <div class="modal-confirmacao-corpo">
            <p>Tem certeza que deseja resetar a numeração dos pedidos?</p>
            <p>📝 Próximo pedido começará do número sequencial correto <strong>(ID 1).</strong></p>
            <p>⚠️ <strong>Esta ação não afeta os pedidos existentes, apenas a numeração futura.</strong></p>
        </div>
        <div class="modal-confirmacao-rodape">
            <button class="btn-modal btn-modal-cancelar" onclick="fecharModalResetNumeracao()">
                <i class="fas fa-times"></i> Cancelar
            </button>
            <button class="btn-modal btn-modal-confirmar" onclick="confirmarResetNumeracao()">
                <i class="fas fa-redo"></i> Sim, Resetar
            </button>
        </div>
    </div>
</div>

<!-- 👇 MODAL DE CONFIRMAÇÃO PARA EXCLUSÃO DE TODOS OS PEDIDOS (PADRONIZADO) -->
<div id="modalExcluirTodos" class="modal-confirmacao">
    <div class="modal-confirmacao-conteudo">
        <div class="modal-confirmacao-cabecalho">
            <h3>🗑️ Confirmar Exclusão Total</h3>
            <span class="modal-confirmacao-fechar" onclick="fecharModalExcluirTodos()">&times;</span>
        </div>
        <div class="modal-confirmacao-corpo">
            <p>Tem certeza que deseja excluir <strong>TODOS</strong> os pedidos do sistema?</p>
            <p>⚠️ <strong>Esta ação não pode ser desfeita e removerá todos os registros de pedidos!</strong></p>
            <p>📊 Total de pedidos: <strong id="total-pedidos-excluir">0</strong></p>
        </div>
        <div class="modal-confirmacao-rodape">
            <button class="btn-modal btn-modal-cancelar" onclick="fecharModalExcluirTodos()">
                <i class="fas fa-times"></i> Cancelar
            </button>
            <button class="btn-modal btn-modal-confirmar" onclick="confirmarExclusaoTodos()">
                <i class="fas fa-trash-alt"></i> Sim, Excluir Tudo
            </button>
        </div>
    </div>
</div>

<script>
    // 👇 VARIÁVEIS GLOBAIS PARA EXCLUSÃO DE PEDIDOS
    let pedidoIdParaExcluir = null;
    let pedidoValorParaExcluir = null;

    // 👇 VARIÁVEIS GLOBAIS PARA ATUALIZAR STATUS
    let pedidoIdParaAtualizar = null;
    let novoStatusParaAtualizar = null;

    // 👇 FUNÇÃO PARA ATUALIZAR ÍCONE DO STATUS NO DROPDOWN
    function atualizarIconeStatus(pedidoId) {
        const select = document.getElementById(`status-${pedidoId}`);
        const selectedOption = select.options[select.selectedIndex];
        console.log(`Status atualizado para: ${selectedOption.text}`);
    }

    // 👇 FUNÇÃO PARA TOGGLE DO DROPDOWN COM ANIMAÇÃO DA SETA (CORRIGIDA)
    function toggleDropdown(button) {
        const dropdownContent = button.nextElementSibling;
        const dropdownArrow = button.querySelector('.dropdown-arrow');
        
        // Alterna o dropdown
        dropdownContent.classList.toggle('active');
        
        // Animação da seta - CORREÇÃO: padrão para baixo, ativo para cima
        if (dropdownContent.classList.contains('active')) {
            dropdownArrow.classList.remove('fa-chevron-down');
            dropdownArrow.classList.add('fa-chevron-up');
        } else {
            dropdownArrow.classList.remove('fa-chevron-up');
            dropdownArrow.classList.add('fa-chevron-down');
        }
    }

    // Fecha dropdowns ao clicar fora
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.pedido-acoes-dropdown')) {
            document.querySelectorAll('.dropdown-content-pedido').forEach(dropdown => {
                dropdown.classList.remove('active');
            });
            document.querySelectorAll('.dropdown-arrow').forEach(arrow => {
                arrow.classList.remove('fa-chevron-up');
                arrow.classList.add('fa-chevron-down');
            });
        }
    });

    // 👇 FILTRAR POR STATUS
    function filtrarPorStatus(status) {
        window.location.href = `/admin/pedidos?status=${status}`;
    }

    // 👇 ABRIR MODAL DE ATUALIZAR STATUS
    function abrirModalAtualizarStatus(pedidoId) {
        pedidoIdParaAtualizar = pedidoId;
        const select = document.getElementById(`status-${pedidoId}`);
        novoStatusParaAtualizar = select.value;

        document.getElementById('id-pedido-atualizar').textContent = '#' + pedidoId;
        document.getElementById('novo-status-atualizar').textContent = document.querySelector(`#status-${pedidoId} option[value="${novoStatusParaAtualizar}"]`).textContent;
        document.getElementById('modalAtualizarStatus').style.display = 'block';
    }

    // 👇 FECHAR MODAL DE ATUALIZAR STATUS
    function fecharModalAtualizarStatus() {
        document.getElementById('modalAtualizarStatus').style.display = 'none';
        pedidoIdParaAtualizar = null;
        novoStatusParaAtualizar = null;
    }

    // 👇 CONFIRMAR ATUALIZAR STATUS
    function confirmarAtualizarStatus() {
        if (pedidoIdParaAtualizar && novoStatusParaAtualizar) {
            fetch(`/admin/pedido/${pedidoIdParaAtualizar}/status`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ status: novoStatusParaAtualizar })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.redirect) {
                        // Redireciona para a mesma página para mostrar a flash message
                        const urlParams = new URLSearchParams(window.location.search);
                        const statusFilter = urlParams.get('status') || 'todos';
                        window.location.href = `/admin/pedidos?status=${statusFilter}`;
                    } else if (!data.success && data.redirect) {
                        // Também redireciona para mostrar mensagem de erro
                        const urlParams = new URLSearchParams(window.location.search);
                        const statusFilter = urlParams.get('status') || 'todos';
                        window.location.href = `/admin/pedidos?status=${statusFilter}`;
                    } else if (!data.success) {
                        alert('Erro ao atualizar status: ' + (data.message || 'Erro desconhecido'));
                    }
                })
                .catch(error => {
                    alert('Erro de conexão ao atualizar status');
                });
        }
        fecharModalAtualizarStatus();
    }

    // 👇 ABRIR MODAL DE EXCLUSÃO DE PEDIDO
    function abrirModalExclusaoPedido(id, valor) {
        pedidoIdParaExcluir = id;
        pedidoValorParaExcluir = valor;

        document.getElementById('id-pedido-excluir').textContent = '#' + id;
        document.getElementById('valor-pedido-excluir').textContent = 'R$ ' + valor.toFixed(2);
        document.getElementById('modalExclusaoPedido').style.display = 'block';
    }

    // 👇 FECHAR MODAL DE PEDIDO
    function fecharModalPedido() {
        document.getElementById('modalExclusaoPedido').style.display = 'none';
        pedidoIdParaExcluir = null;
        pedidoValorParaExcluir = null;
    }

    // 👇 CONFIRMAR EXCLUSÃO DE PEDIDO
    function confirmarExclusaoPedido() {
        if (pedidoIdParaExcluir) {
            fetch(`/admin/pedido/${pedidoIdParaExcluir}/excluir`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // 🔥 REDIRECIONA PARA A MESMA PÁGINA PARA MOSTRAR A MENSAGEM FLASH
                        window.location.href = '/admin/pedidos?status=' + (new URLSearchParams(window.location.search).get('status') || 'todos');
                    } else {
                        // Mostra alerta temporário se der erro
                        alert('Erro: ' + data.message);
                        location.reload();
                    }
                })
                .catch(error => {
                    console.error('Erro:', error);
                    location.reload();
                });
        }
        fecharModalPedido();
    }

    // 👇 FUNÇÕES PARA RESET DE NUMERAÇÃO
    function abrirModalResetNumeracao() {
        document.getElementById('modalResetNumeracao').style.display = 'block';
    }

    function fecharModalResetNumeracao() {
        document.getElementById('modalResetNumeracao').style.display = 'none';
    }

    function confirmarResetNumeracao() {
        fetch('/admin/pedidos/reset-numeracao', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Recarrega a página para mostrar a mensagem de sucesso
                    window.location.href = '/admin/pedidos?status=todos';
                } else {
                    alert('Erro: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao resetar numeração');
            });

        fecharModalResetNumeracao();
    }

    // 👇 FUNÇÕES PARA EXCLUSÃO DE TODOS OS PEDIDOS
    function abrirModalExcluirTodos() {
        document.getElementById('total-pedidos-excluir').textContent = {{ pedidos | length }};
        document.getElementById('modalExcluirTodos').style.display = 'block';
    }

    function fecharModalExcluirTodos() {
        document.getElementById('modalExcluirTodos').style.display = 'none';
    }

    function confirmarExclusaoTodos() {
        fetch('/admin/pedidos/excluir-todos', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Recarrega a página para mostrar a mensagem de sucesso
                    window.location.href = '/admin/pedidos?status=todos';
                } else {
                    alert('Erro: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao excluir todos os pedidos');
            });

        fecharModalExcluirTodos();
    }

    // 👇 FECHAR MODAL AO CLICAR FORA
    document.getElementById('modalAtualizarStatus').addEventListener('click', function (e) {
        if (e.target === this) {
            fecharModalAtualizarStatus();
        }
    });

    document.getElementById('modalExclusaoPedido').addEventListener('click', function (e) {
        if (e.target === this) {
            fecharModalPedido();
        }
    });

    document.getElementById('modalResetNumeracao').addEventListener('click', function (e) {
        if (e.target === this) {
            fecharModalResetNumeracao();
        }
    });

    document.getElementById('modalExcluirTodos').addEventListener('click', function (e) {
        if (e.target === this) {
            fecharModalExcluirTodos();
        }
    });
</script>
<style>
    .estatisticas-compactas {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-bottom: 25px;
    }

    .filtro-status-compacto {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        justify-content: center;
    }

    .btn-status-compacto {
        padding: 8px 16px;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
        color: white;
        font-size: 12px;
        white-space: nowrap;
    }

    .btn-status-compacto.todos {
        background: linear-gradient(135deg, #ff6b8b, #ff4d73);
    }

    .btn-status-compacto.pendente {
        background: linear-gradient(135deg, #f39c12, #e67e22);
    }

    .btn-status-compacto.processando {
        background: linear-gradient(135deg, #3498db, #2980b9);
    }

    .btn-status-compacto.pronto {
        background: linear-gradient(135deg, #9b59b6, #8e44ad);
    }

    .btn-status-compacto.enviado {
        background: linear-gradient(135deg, #1abc9c, #16a085);
    }

    .btn-status-compacto.entregue {
        background: linear-gradient(135deg, #27ae60, #219653);
    }

    .btn-status-compacto.cancelado {
        background: linear-gradient(135deg, #242525, #34495e);
    }

    .btn-status-compacto:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .btn-status-compacto.ativo {
        transform: scale(1.05);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .acoes-avancadas {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .btn-status-avancado {
        padding: 10px 20px;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        color: white;
        font-size: 14px;
    }

    .btn-status-avancado.reset-numeracao {
        background: linear-gradient(135deg, #867d7b, #2b2e2d);
    }

    .btn-status-avancado.excluir-todos {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
    }

    .btn-status-avancado:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .btn-status-avancado.reset-numeracao:hover {
        box-shadow: 0 6px 20px rgba(0, 206, 201, 0.4);
    }

    .btn-status-avancado.excluir-todos:hover {
        box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
    }

    .pedidos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
        gap: 25px;
        margin-top: 20px;
    }

    .pedido-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        border-left: 5px solid;
        transition: transform 0.3s ease;
        min-height: 380px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        position: relative;
        z-index: 1;
    }

    .pedido-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .pedido-card.pendente {
        border-left-color: #f39c12;
    }

    .pedido-card.processando {
        border-left-color: #3498db;
    }

    .pedido-card.pronto {
        border-left-color: #9b59b6;
    }

    .pedido-card.enviado {
        border-left-color: #1abc9c;
    }

    .pedido-card.entregue {
        border-left-color: #27ae60;
    }

    .pedido-card.cancelado {
        border-left-color: #2c3e50;
    }

    .pedido-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
    }

    .pedido-info h3 {
        color: #ff6b8b;
        margin: 0 0 5px 0;
    }

    .pedido-status {
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: bold;
        font-size: 0.9em;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .status-pendente {
        background: #fef5e7;
        color: #b06c0f;
    }

    .status-processando {
        background: #e8f4fd;
        color: #1a5d8a;
    }

    .status-pronto {
        background: #f4ecf7;
        color: #6c3483;
    }

    .status-enviado {
        background: #e8f6f3;
        color: #117864;
    }

    .status-entregue {
        background: #eafaf1;
        color: #196f3d;
    }

    .status-cancelado {
        background: #ecf0f1;
        color: #2c3e50;
    }

    .pedido-detalhes {
        margin-bottom: 20px;
    }

    .pedido-itens {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px dashed #ddd;
        flex-grow: 1;
    }

    .item-pedido {
        display: flex;
        justify-content: space-between;
        padding: 5px 0;
        font-size: 0.9em;
    }

    /* 🔽 DROPDOWN CORRIGIDO - COM FUNDO ROSA */
    .pedido-acoes-dropdown {
        position: relative;
        display: block;
        margin-top: 20px;
        z-index: 10;
    }

    .dropdown-trigger-pedido {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 20px;
        background: linear-gradient(135deg, #ff6b8b, #ff4d73);
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 10px rgba(255, 107, 139, 0.3);
        font-size: 14px;
        width: 100%;
    }

    .dropdown-trigger-pedido:hover {
        background: linear-gradient(135deg, #ff4d73, #ff3366);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255, 107, 139, 0.4);
    }

    .dropdown-arrow {
        transition: transform 0.3s ease;
        font-size: 12px;
    }

    .dropdown-content-pedido {
        display: none;
        position: absolute;
        bottom: 100%;
        left: 0;
        right: 0;
        background: linear-gradient(135deg, #ff6b8b, #ff4d73);
        min-width: 280px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        border-radius: 12px;
        z-index: 1000;
        overflow: hidden;
        margin-bottom: 10px;
        border: none;
    }

    .dropdown-content-pedido.active {
        display: block;
    }

    .status-section {
        padding: 15px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.3);
    }

    .status-section label {
        display: block;
        color: white;
        font-weight: 600;
        margin-bottom: 8px;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .dropdown-content-pedido .select-status {
        width: 100%;
        padding: 10px 12px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        font-size: 14px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 16px;
    }

    /* CORREÇÃO: Remove o destaque azul do select quando em foco */
    .dropdown-content-pedido .select-status:focus {
        outline: none;
        border-color: rgba(255, 255, 255, 0.6);
        box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.2);
    }

    .dropdown-content-pedido .select-status option {
        background: #ff6b8b;
        color: white;
        padding: 8px;
    }

    .dropdown-item-pedido {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 15px 20px;
        text-decoration: none;
        color: white;
        transition: all 0.3s ease;
        border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        background: none;
        border: none;
        width: 100%;
        text-align: left;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
    }

    .dropdown-item-pedido:hover {
        background: rgba(255, 255, 255, 0.2);
        color: white;
    }

    .dropdown-item-pedido:last-child {
        border-bottom: none;
    }

    /* 🔽 ESTILO PARA NENHUM PEDIDO - BOTÃO CENTRALIZADO */
    .nenhum-pedido {
        text-align: center;
        padding: 50px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        grid-column: 1 / -1;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
    }

    .btn-container {
        display: flex;
        justify-content: center;
        width: 100%;
    }

    /* 🔽 CORREÇÃO: BOTÕES CANCELAR PADRONIZADOS EM ROSA */
    .btn-modal {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 12px 25px;
        border-radius: 25px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        font-size: 16px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    .btn-modal-cancelar {
        background: linear-gradient(135deg, #ff6b8b, #ff4d73);
        color: white;
    }

    .btn-modal-confirmar {
        background: linear-gradient(135deg, #ff6b8b, #ff4d73);
        color: white;
    }

    .btn-modal-cancelar:hover {
        background: linear-gradient(135deg, #ff4d73, #9b59b6);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255, 107, 139, 0.4);
    }

    .btn-modal-confirmar:hover {
        background: linear-gradient(135deg, #ff4d73, #9b59b6);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255, 107, 139, 0.4);
    }

    /* Estilos para modais de confirmação - PADRONIZADO */
    .modal-confirmacao {
        display: none;
        position: fixed;
        z-index: 10000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
    }

    .modal-confirmacao-conteudo {
        background: white;
        margin: 10% auto;
        padding: 0;
        border-radius: 15px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        overflow: hidden;
    }

    .modal-confirmacao-cabecalho {
        background: linear-gradient(135deg, #ff6b8b, #ff4d73);
        color: white;
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-confirmacao-cabecalho h3 {
        margin: 0;
        font-size: 1.4em;
    }

    .modal-confirmacao-fechar {
        font-size: 1.8em;
        cursor: pointer;
    }

    .modal-confirmacao-corpo {
        padding: 30px;
        text-align: center;
    }

    .modal-confirmacao-rodape {
        padding: 20px;
        text-align: center;
        border-top: 1px solid #eee;
        display: flex;
        gap: 15px;
        justify-content: center;
    }

    @media (max-width: 768px) {
        .pedidos-grid {
            grid-template-columns: 1fr;
        }

        .filtro-status-compacto {
            justify-content: center;
        }

        .btn-status-compacto {
            padding: 8px 15px;
            font-size: 12px;
        }

        .pedido-header {
            flex-direction: column;
            gap: 10px;
        }

        .modal-confirmacao-rodape {
            flex-direction: column;
        }

        .btn-modal {
            width: 100%;
            justify-content: center;
        }

        .dropdown-content-pedido {
            position: fixed;
            bottom: 50%;
            left: 50%;
            transform: translate(-50%, 50%);
            width: 90%;
            max-width: 300px;
        }

        .nenhum-pedido {
            padding: 30px 20px;
        }
    }
</style>
{% endblock %}